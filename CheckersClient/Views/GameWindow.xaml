<Window x:Class="CheckersClient.Views.GameWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Шашки Онлайн" Height="800" Width="850" 
        WindowStartupLocation="CenterScreen"
        Background="#2C3E50">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="80"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="60"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#34495E" BorderBrush="#1ABC9C" BorderThickness="0,0,0,3"
                CornerRadius="10,10,0,0" Margin="10,10,10,0">
            <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                <TextBlock Text="ШАШКИ ОНЛАЙН" 
                           FontSize="28" FontWeight="Bold" 
                           Foreground="#ECF0F1" 
                           HorizontalAlignment="Center"
                           Margin="0,10,0,5"/>
                <TextBlock Text="{Binding CurrentPlayer, StringFormat='Ходит: {0}'}" 
                           FontSize="16" 
                           Foreground="#1ABC9C" 
                           HorizontalAlignment="Center"
                           FontWeight="SemiBold"/>
            </StackPanel>
        </Border>

        <!-- Игровая доска -->
        <Border Grid.Row="1" Background="#34495E" BorderBrush="#1ABC9C" 
                BorderThickness="3" CornerRadius="10" Margin="10,5,10,5">
            <Border.Effect>
                <DropShadowEffect Color="Black" Direction="270" ShadowDepth="10" 
                                  BlurRadius="20" Opacity="0.7"/>
            </Border.Effect>
            <Viewbox Stretch="Uniform" Margin="20">
                <!-- Прямая сетка 8x8 без вложенности -->
                <ItemsControl ItemsSource="{Binding Board}" Width="640" Height="640">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <!-- Каждая строка -->
                            <ItemsControl ItemsSource="{Binding}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <!-- Одна клетка -->
                                        <Border Background="{Binding Background}"
                                                BorderBrush="{Binding BorderBrush}"
                                                BorderThickness="{Binding BorderThickness}"
                                                Width="80" Height="80">
                                            <Button Background="Transparent" 
                                                    BorderThickness="0"
                                                    Command="{Binding DataContext.CellClicked, 
                                                              RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand"
                                                    Padding="0">
                                                <Grid>
                                                    <!-- Шашка -->
                                                    <Ellipse Width="60" Height="60" 
                                                             Fill="{Binding PieceWpfColor}"
                                                             Stroke="#2C3E50" StrokeThickness="2"
                                                             Visibility="{Binding PieceVisibility}">
                                                        <Ellipse.Effect>
                                                            <DropShadowEffect Color="Black" 
                                                                              Direction="270" 
                                                                              ShadowDepth="3" 
                                                                              BlurRadius="5" 
                                                                              Opacity="0.5"/>
                                                        </Ellipse.Effect>
                                                    </Ellipse>

                                                    <!-- Индикатор дамки -->
                                                    <Ellipse Width="20" Height="20" 
                                                             Fill="#E74C3C"
                                                             Visibility="{Binding KingIndicatorVisibility}">
                                                        <Ellipse.Effect>
                                                            <DropShadowEffect Color="#C0392B" 
                                                                              BlurRadius="8" 
                                                                              Opacity="0.8"/>
                                                        </Ellipse.Effect>
                                                    </Ellipse>

                                                    <!-- Индикатор обычного хода (зелёный круг) -->
                                                    <Ellipse Width="25" Height="25" 
                                                             Fill="#2ECC71" 
                                                             Opacity="0.7"
                                                             Visibility="{Binding MoveIndicatorVisibility}"/>

                                                    <!-- Индикатор обязательного взятия (оранжевый ромб) -->
                                                    <Path Data="M 0,40 L 40,0 L 80,40 L 40,80 Z"
                                                          Fill="#E67E22" 
                                                          Opacity="0.8"
                                                          Stretch="Uniform"
                                                          Width="35" Height="35"
                                                          Visibility="{Binding CaptureIndicatorVisibility}">
                                                        <Path.Effect>
                                                            <DropShadowEffect Color="#D35400" 
                                                                              BlurRadius="10" 
                                                                              Opacity="0.9"/>
                                                        </Path.Effect>
                                                    </Path>
                                                </Grid>
                                            </Button>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Viewbox>
        </Border>

        <!-- Статус -->
        <Border Grid.Row="2" Background="#34495E" BorderBrush="#1ABC9C" 
                BorderThickness="0,3,0,0" CornerRadius="0,0,10,10" 
                Margin="10,0,10,10">
            <TextBlock Text="{Binding Status}" 
                       FontSize="18" FontWeight="SemiBold"
                       Foreground="#ECF0F1" 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center"
                       TextWrapping="Wrap"
                       Margin="20,0"/>
        </Border>
    </Grid>
</Window>
